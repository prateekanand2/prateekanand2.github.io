{% comment %}
  This template fetches repository data directly from GitHub API
  Replace your existing _includes/repository/repo.liquid with this
{% endcomment %}

{% assign repo_parts = include.repository | split: "/" %}
{% assign username = repo_parts[0] %}
{% assign repo_name = repo_parts[1] %}

<div class="repo p-3 mb-3">
  <div class="repo-header d-flex justify-content-between align-items-center">
    <h4 class="repo-name">
      <a href="https://github.com/{{ include.repository }}" target="_blank" rel="noopener noreferrer">
        <i class="fab fa-github"></i> {{ repo_name }}
      </a>
    </h4>
  </div>
  
  <div class="repo-meta">
    <span class="repo-language">
      <i class="fas fa-circle" style="color: #f1e05a;"></i> 
      <span class="language-name" data-repo="{{ include.repository }}">Loading...</span>
    </span>
    <span class="repo-stars">
      <i class="fas fa-star"></i> 
      <span class="star-count" data-repo="{{ include.repository }}">-</span>
    </span>
    <span class="repo-forks">
      <i class="fas fa-code-branch"></i> 
      <span class="fork-count" data-repo="{{ include.repository }}">-</span>
    </span>
  </div>
  
  <p class="repo-description" data-repo="{{ include.repository }}">
    Loading repository information...
  </p>
</div>

<script>
(function() {
  const repo = "{{ include.repository }}";
  const apiUrl = `https://api.github.com/repos/${repo}`;
  
  fetch(apiUrl, {
    headers: {
      'Accept': 'application/vnd.github.v3+json'
    }
  })
  .then(response => {
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    return response.json();
  })
  .then(data => {
    // Update description
    const descriptionEl = document.querySelector(`.repo-description[data-repo="${repo}"]`);
    if (descriptionEl) {
      descriptionEl.textContent = data.description || 'No description available';
    }
    
    // Update language
    const languageEl = document.querySelector(`.language-name[data-repo="${repo}"]`);
    if (languageEl) {
      languageEl.textContent = data.language || 'Unknown';
    }
    
    // Update stars
    const starsEl = document.querySelector(`.star-count[data-repo="${repo}"]`);
    if (starsEl) {
      starsEl.textContent = data.stargazers_count || 0;
    }
    
    // Update forks
    const forksEl = document.querySelector(`.fork-count[data-repo="${repo}"]`);
    if (forksEl) {
      forksEl.textContent = data.forks_count || 0;
    }
  })
  .catch(error => {
    console.error('Error fetching repo data:', error);
    const descriptionEl = document.querySelector(`.repo-description[data-repo="${repo}"]`);
    if (descriptionEl) {
      descriptionEl.textContent = 'Error loading repository information. Please check back later.';
    }
  });
})();
</script>

<style>
.repo {
  border: 1px solid var(--global-divider-color);
  border-radius: 6px;
  background-color: var(--global-bg-color);
  transition: transform 0.2s, box-shadow 0.2s;
}

.repo:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.repo-name a {
  color: var(--global-theme-color);
  text-decoration: none;
}

.repo-name a:hover {
  text-decoration: underline;
}

.repo-meta {
  display: flex;
  gap: 1rem;
  margin: 0.5rem 0;
  font-size: 0.9rem;
  color: var(--global-text-color-light);
}

.repo-meta span {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.repo-description {
  color: var(--global-text-color);
  margin-top: 0.5rem;
  font-size: 0.95rem;
}
</style>
